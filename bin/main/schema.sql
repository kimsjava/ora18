-- 기존 BOARDS 테이블 삭제 (오류 발생 시 무시)
DROP TABLE BOARDS CASCADE CONSTRAINTS@@

-- BOARDS 테이블 생성 (Oracle 18c에서 IDENTITY 문법 사용)
CREATE TABLE BOARDS (
    ID NUMBER(19,0) GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    CONTENTS VARCHAR2(255 CHAR),
    CREATED_AT TIMESTAMP(6),
    NAME VARCHAR2(255 CHAR),
    UPDATED_AT TIMESTAMP(6)
)@@

-- 컬럼 및 테이블 설명 추가
COMMENT ON COLUMN BOARDS.ID IS '게시글 ID'@@
COMMENT ON COLUMN BOARDS.CONTENTS IS '게시글 내용'@@
COMMENT ON COLUMN BOARDS.CREATED_AT IS '생성 일시'@@
COMMENT ON COLUMN BOARDS.NAME IS '게시글 이름'@@
COMMENT ON COLUMN BOARDS.UPDATED_AT IS '수정 일시'@@
COMMENT ON TABLE BOARDS IS '게시판 테이블'@@

-- 기존 test_table 삭제 (오류 발생 시 무시)
DROP TABLE test_table CASCADE CONSTRAINTS@@

-- test_table 생성 (IDENTITY 사용)
CREATE TABLE test_table (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY,
    name VARCHAR2(50) NOT NULL,
    created_at DATE DEFAULT SYSDATE,
    CONSTRAINT pk_test_table PRIMARY KEY (id)
)@@

-- 기존 board_table 삭제 (오류 발생 시 무시)
DROP TABLE board_table CASCADE CONSTRAINTS@@

-- board_table 생성 (IDENTITY 미지원 환경을 위해 시퀀스+트리거 사용)
CREATE TABLE board_table (
    id NUMBER,
    name VARCHAR2(100) NOT NULL,
    contents VARCHAR2(4000) NOT NULL,
    created_at DATE DEFAULT SYSDATE,
    updated_at DATE DEFAULT SYSDATE,
    CONSTRAINT pk_board_table PRIMARY KEY (id)
)@@

-- 기존 board_table_seq 시퀀스 삭제 (존재할 경우)
BEGIN
   EXECUTE IMMEDIATE 'DROP SEQUENCE board_table_seq';
EXCEPTION
   WHEN OTHERS THEN
      IF SQLCODE != -2289 THEN
         RAISE;
      END IF;
END;
@@

-- 시퀀스 생성
CREATE SEQUENCE board_table_seq START WITH 1 INCREMENT BY 1 NOCACHE@@

-- 트리거 생성
CREATE OR REPLACE TRIGGER board_table_insert_trigger
BEFORE INSERT ON board_table
FOR EACH ROW
BEGIN
    IF :NEW.id IS NULL THEN
        SELECT board_table_seq.NEXTVAL INTO :NEW.id FROM dual;
    END IF;
END;@@

COMMIT@@